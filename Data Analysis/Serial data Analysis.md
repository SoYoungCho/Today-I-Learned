# 시계열 데이터 분석

## 분석 순서

- 내삽법 (interpolation)
	- 다양한 샘플링 주파수로 된 **시계열 데이터를 합치거나 누락된 데이터를 추정**해 데이터의 샘플링 주파수를 통일
- 타임스탬프 데이터의 경우 배열에 넣어 시계열 주파수로 변환
- 잡읍이 많으면 smoothing 필터로 제거, 데이터 범위 등 조정
- 윈도우 씌워 프레임 데이터로 변환
	- 윈도우 크기, 중복 구간 길이 등 잘 정해야
- 프레임마다 필요한 Feature 추출 후 머신러닝 모델에 입력

### 내삽법과 외삽법

1. 내삽법 (interoplation)
- 데이터가 중간에 빈 시점의 값을 구하는 과정
- 방법 : 가장 가까운 t를 사용
	- 바로 이전의 t 사용시 forwardfill
	- 바로 다음의 t 사용시 backfill

2. 스플라인 (spline) 내삽
- 직선 X, 곡선으로 점을 잇는 방법
- 3차 함수 흔히 이용 --> 큐빅 스플라인 (cubic)

3. 외삽법 (extrapolation)
- 구간 밖의 값을 추정
- 보통 정확도가 더 떨어짐

### 신호 스무딩
- 시계열 데이터 부드럽게
- 방법1. 평균값 필터 (moving average)
	- 근처에 있는 값의 평균으로 원래 값 대체
	- 보통 많이 사용하나 데이터에 impulse 잡음이 포함되어 있는 경우 잘 작동하지 않는다.
		- 참고 : 임펄스 노이즈는 원하지 않는 거의 순간적인 날카로운 사운드를 포함하는 노이즈 범주
		- 이 경우 중간값 필터 사용하면 되지만, 평균값 필터보다 더 연산량이 많으므로 사용에 유의해야.
			- 이유? 평균값은 다 더해서 나누면 되는데, 중간값은 정렬이 필요해서 (내 생각)
		- 데이터 적정범위가 있다면 범위 외 값은 아웃라이어처럼 감쇠시키고 스무딩 하면 된다.
- 방법2. 가중 평균
	- 거리가 가까운 신호에 큰 가중치
- 방법3. 지수 스무딩 (exponential smoothing)
	- 과거 값에 지수적으로 감소하는 가중치 줌

### 데이터 전처리
- 값이 지수적으로 변할 경우 로그를 씌운다
- 특히 회귀 모델에 전처리 영향이 큼

### 추세와 주기성
- 주기
	- 주어진 데이터가 요일별로 주기가 있다면, 주기는 7로 하면 된다
- but,
	-  주기를 정확히 알아야 이런 분석 가능
	- 전체 데이터가 서로 **독립적인 주기 성분**과 **잡음의 합**이라는 가정이 성립해야
- 주기 성분 구하는 법 : 전체 데이터를 주기로 잘라 평균을 취한다

### 윈도우
- 윈도우를 적용한다는 것은?
	- 신호를 일정 크기로 나누고 각각 Feature 추출
- 윈도우를 머신러닝에 적용하는 법
	- 일정 길이로 윈도우 적용
	- 윈도우 내부에서 푸리에 성분이나 평균값 구함
	- 윈도우 별 레이블 붙임
	- 데이터를 머신러닝에 적용
- 윈도우는 서로 겹치지 않게 적용하는 방법이 효율적
- 주의할 것 !
	- **주기성** 고려하여 윈도우 길이 정하기
		- 예) 낮에 기온 올라가고, 밤에 내려가는 주기가 있을 때
		- 24시간 단위로 자르면 주기성이 사라짐 (윈도우 길이 너무 길게 잡음)

### Feature 추출
1. Feature 종류
- mean, median, 4분위 값, 표준 편차
- 커브피팅 계수
- 참고
	- 윈도우 사용시 : 최근에 발생한 값을 알 수 있음
	- 데이터 전체 사용시 : 전체의 분포에서 얻는 정보가 있음
	- 따라서 현실적으로 둘 다 사용
2. Feature 추출 심화
- 윈도우 적용시 데이터 그 자체가 벡터임. 따라서 평균 값은거 안 구하고 그대로 활용 가능
- 윈도우 벡터 사용시 **PCA**(주성분 분해) 같은 전처리 거치기도.
- (1) 벡터 크기 --> 기준 벡터와 윈도우 벡터의 거리 계산 (L1, L2)
- (2) 벡터의 방향성 --> 벡터 크기를 1로 정규화
- (3) 유사도 --> 내적으로 거리 계산
- (4) clustering 적용 가능
	- 예) k-means. 새로운 시계열 데이터 들어오면 데이터가 어떤 클러스터에 가장 가까운지 측정 후 피처로 사용 가능
- (5) Feature 사용시 윈도우 크기의 중요성
	- 너무 짧을 경우 원하는 패턴을 포함하지 않을 수 있기에 feature 의미가 없어짐
	- 따라서 필요한 패턴의 모양, 크기 가늠하여 윈도우 선택

### 푸리에 분석
- 정의 : 시계열 데이터를 여러 주파수 성분의 합으로 나타냄
	- sin과 cos 함수 이용해 다양한 주기 갖는 성분으로 나눔
	- 식의 형태 --> 시계열 데이터 x = a0 + (a * cos 어쩌구 값) + (b * sin 어쩌구 값)
		- a0는 전체 시계열 데이터 오프셋
		- a, b는 푸리에 계수
	- a, b를 합쳐서 c 로 나타내면 --> = c * sin 어쩌구 값
		- 이 때  계수 c가 나타내는 벡터가 **스펙트럼**
		- 주기 성분이 있으면 c가 커짐
- 푸리에 분석은 **다양한 성분으로 데이터 분해**한다는 점이 PCA와 유사
- 언제 사용?
	- 신호에서 주기성 알아낼 때
	- 윈도우 벡터에 푸리에 분석 수행해 feature로 사용
		- 주의 ! 푸리에 분석 시 복소수로 값이 나오기에 여기에 절대값을 씌워야.
	- low-pass filter : 푸리에 분석 결과 중 **고주파 성분**은 잡음에 해당하는 경우 많음 (noise). 이를 제거
	- high-pass filter : 반대로, 저주파 성분 제거 --> 장기적 추세 제거하는 효과
